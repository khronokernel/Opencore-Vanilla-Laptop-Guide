
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>GPU Patching Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    

    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="acpi.html" />
    
    
    <link rel="prev" href="legacy.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    OpenCore Laptop Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../installer-guide/opencore-efi.html">
            
                <a href="../installer-guide/opencore-efi.html">
            
                    
                    Creating the USB
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../installer-guide/mac-install.html">
            
                <a href="../installer-guide/mac-install.html">
            
                    
                    macOS install
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../installer-guide/winblows-install.html">
            
                <a href="../installer-guide/winblows-install.html">
            
                    
                    Windows install
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../ktext.html">
            
                <a href="../ktext.html">
            
                    
                    Gathering files
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Intel Config.plist</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../config.plist/ivy-bridge.html">
            
                <a href="../config.plist/ivy-bridge.html">
            
                    
                    Ivy Bridge
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../config.plist/haswell.html">
            
                <a href="../config.plist/haswell.html">
            
                    
                    Haswell
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../config.plist/broadwell.html">
            
                <a href="../config.plist/broadwell.html">
            
                    
                    Broadwell
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../config.plist/skylake.html">
            
                <a href="../config.plist/skylake.html">
            
                    
                    Skylake
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../config.plist/kaby-lake.html">
            
                <a href="../config.plist/kaby-lake.html">
            
                    
                    Kaby Lake
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="../config.plist/coffee-lake-8th-gen.html">
            
                <a href="../config.plist/coffee-lake-8th-gen.html">
            
                    
                    Coffee Lake(8th Gen)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="../config.plist/coffee-lake-9th-gen.html">
            
                <a href="../config.plist/coffee-lake-9th-gen.html">
            
                    
                    Coffee Lake(9th Gen)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="../config.plist/comet-lake.html">
            
                <a href="../config.plist/comet-lake.html">
            
                    
                    Comet Lake
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Post Install</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../post-install/nvram.html">
            
                <a href="../post-install/nvram.html">
            
                    
                    Emulated NVRAM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../post-install/spoof.html">
            
                <a href="../post-install/spoof.html">
            
                    
                    Disabling GPU
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../post-install/security.html">
            
                <a href="../post-install/security.html">
            
                    
                    Security and FileVault
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Troubleshooting</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../troubleshooting/troubleshooting.html">
            
                <a href="../troubleshooting/troubleshooting.html">
            
                    
                    General Troubleshooting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../troubleshooting/debug.html">
            
                <a href="../troubleshooting/debug.html">
            
                    
                    OpenCore Debugging
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Extras</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="legacy.html">
            
                <a href="legacy.html">
            
                    
                    Legacy Install
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="5.2" data-path="gpu-patches.html">
            
                <a href="gpu-patches.html">
            
                    
                    GPU Patching
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="acpi.html">
            
                <a href="acpi.html">
            
                    
                    Getting started with ACPI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="../troubleshooting/verbose.html">
            
                <a href="../troubleshooting/verbose.html">
            
                    
                    Fixing Resolution and Verbose
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="kalsr-fix.html">
            
                <a href="kalsr-fix.html">
            
                    
                    Fixing KALSR slide values
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="msr-lock.html">
            
                <a href="msr-lock.html">
            
                    
                    Fixing CFG Lock
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.7" data-path="../post-install/iservices.html">
            
                <a href="../post-install/iservices.html">
            
                    
                    Fixing iServices
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Misc</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../misc/credit.html">
            
                <a href="../misc/credit.html">
            
                    
                    Credit
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >GPU Patching</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="gpu-patching">GPU Patching</h1>
<p>Last edited: January 13, 2020</p>
<p>This little section is for those who need more than what is provided by simple framebuffer patching and WhateverGreen&apos;s autopatches:</p>
<ul>
<li><a href="gpu-patches.html#Converting-a-clover-fakeID-to-OpenCore">Applying a fakeID for unsupported GPUs</a></li>
<li><a href="gpu-patches.html#iGPU-BusID-Patching">iGPU BusID patching for 300 series motherboards</a></li>
</ul>
<h1 id="converting-a-clover-fakeid-to-opencore">Converting a clover fakeID to OpenCore</h1>
<p>With OpenCore, GPU FakeIDs are handled a bit differently. Specifcally that you need to have the PCIRoot path to apply the properties. Luckily FakeIDs are not required to boot, instead only needed for proper GPU acceleration so this can be done in post-install.</p>
<h3 id="finding-the-pciroot-of-your-gpu">Finding the PCIRoot of your GPU</h3>
<p>To find the PCIRoot, you&apos;ll want to grab gfxutil and run the following in terminal:</p>
<pre><code class="lang-text">path/to/gfxutil -f GFX0
</code></pre>
<p>This should give you something like this:</p>
<pre><code class="lang-text">PciRoot(0x20)/Pci(0x0,0x0)/Pci(0x0,0x0)/Pci(0x0,0x0)/Pci(0x0,0x0)
</code></pre>
<p>Note: GFX0 can be replaced with GFX1, etc if the GPU you&apos;re fakeIDing isn&apos;t the first/main GPU. And machine running with CSM enabled and Windows8.1/10 mode(UEFI) disabled may find that the GPU is named <code>display</code> so adjust the above command accodingly.</p>
<h3 id="apply-the-fakeid">Apply the fakeID</h3>
<p>So lets grab a clover fakeID and go through how we&apos;d convert it, for use we&apos;ll choose <code>0x67981002</code> which is the ID associated with the R9 280x and is commonly used by R9 280/380 users.</p>
<p>Looking through clover&apos;s source code we find that fakeIDs are converted into the following properties:</p>
<p>AMD GPUs:</p>
<pre><code class="lang-text">device-id
ATY,DeviceID
@0,compatible
vendor-id
ATY,VendorID
</code></pre>
<p>To convert them, we&apos;ll need to do byte swap. This is due to Endianness:</p>
<ul>
<li>DeviceID: 67 98 -&gt; 98 67</li>
<li>VendorID: 1002 -&gt; 02 10</li>
</ul>
<p>Now we can apply the properties:</p>
<table>
<thead>
<tr>
<th style="text-align:left">Key</th>
<th style="text-align:left">Type</th>
<th style="text-align:left">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">device-id</td>
<td style="text-align:left">Data</td>
<td style="text-align:left">98670000</td>
</tr>
<tr>
<td style="text-align:left">ATY,DeviceID</td>
<td style="text-align:left">Data</td>
<td style="text-align:left">9867</td>
</tr>
<tr>
<td style="text-align:left">vendor-id</td>
<td style="text-align:left">Data</td>
<td style="text-align:left">02100000</td>
</tr>
<tr>
<td style="text-align:left">ATY,VendorID</td>
<td style="text-align:left">Data</td>
<td style="text-align:left">0210</td>
</tr>
</tbody>
</table>
<p>You may notice we excluded <code>@0,compatible</code>, the reasoning for this is thatit actually interferes with WhateverGreen and macOS&apos;s ability to properly setup the GPU. See <a href="https://github.com/acidanthera/WhateverGreen/blob/master/Manual/FAQ.Radeon.en.md" target="_blank">here</a> for more info.</p>
<p>Now navigate into your config.plist under DeviceProperties -&gt; Add where you can apply these properties:</p>
<p><img src="https://i.imgur.com/e7UYS75.png" alt=""></p>
<h1 id="igpu-busid-patching">iGPU BusID Patching</h1>
<p>This section is for users running &quot;true&quot; 300 series motherboards( B360, B365, H310, H370, Z390) who are having issues setting up their iGPU as a display out.</p>
<p>So to get started I&apos;ll assume you&apos;ve already done basic framebuffer patches in your config from the <a href="../config.plist/coffee-lake.md">Coffeelake portion of the guide</a>, it should look something like this:</p>
<p><img src="https://i.imgur.com/lm7LgML.png" alt=""></p>
<p>Now that we&apos;re prepped, we can start looking into busID patching. Checking the dumps on <a href="https://www.insanelymac.com/forum/topic/334899-intel-framebuffer-patching-using-whatevergreen/" target="_blank">Insanelymac</a> shows us this for the <code>3E9B0007</code> ID(Desktop UHD 630):</p>
<pre><code class="lang-text">ID: 3E9B0007, STOLEN: 57 MB, FBMEM: 0 bytes, VRAM: 1536 MB, Flags: 0x00801302
TOTAL STOLEN: 58 MB, TOTAL CURSOR: 1 MB (1572864 bytes), MAX STOLEN: 172 MB, MAX OVERALL: 173 MB (181940224 bytes)
GPU Name: Intel UHD Graphics 630
Model Name(s):
Camelia: Disabled
Mobile: 0, PipeCount: 3, PortCount: 3, FBMemoryCount: 3
[1] busId: 0x05, pipe: 9, type: 0x00000400, flags: 0x000003C7 - DP
[2] busId: 0x04, pipe: 10, type: 0x00000400, flags: 0x000003C7 - DP
[3] busId: 0x06, pipe: 8, type: 0x00000400, flags: 0x000003C7 - DP
01050900 00040000 C7030000
02040A00 00040000 C7030000
03060800 00040000 C7030000
</code></pre>
<p>Looking at all this can be quite overwheling, but we&apos;ll break it down to be a bit simpler. For use we care about this:</p>
<pre><code class="lang-text">[1] busId: 0x05, pipe: 9, type: 0x00000400, flags: 0x000003C7 - DP
[2] busId: 0x04, pipe: 10, type: 0x00000400, flags: 0x000003C7 - DP
[3] busId: 0x06, pipe: 8, type: 0x00000400, flags: 0x000003C7 - DP
01050900 00040000 C7030000
02040A00 00040000 C7030000
03060800 00040000 C7030000
</code></pre>
<p>These are your iGPUs ports by default, lets go through port 1 and see what each section is used for:</p>
<p>The first port:</p>
<pre><code class="lang-text">01050900 00040000 C7030000
</code></pre>
<p>Port: 01</p>
<ul>
<li><strong>01</strong>050900 00040000 C7030000</li>
</ul>
<p>busId: 0x05</p>
<ul>
<li>01<strong>05</strong>0900 00040000 C7030000</li>
</ul>
<p>Pipe Number 9 (little endian):</p>
<ul>
<li>0105<strong>0900</strong> 00040000 C7030000</li>
</ul>
<p>Connector type: DisplayPort</p>
<ul>
<li>01050900 <strong>00040000</strong> C7030000</li>
</ul>
<p>Flags - We leave it as default:</p>
<ul>
<li>01050900 00040000 <strong>C7030000</strong></li>
</ul>
<p>Things to note:</p>
<ul>
<li>You cannot use the same busId twice, having 2 in use will create conflicts</li>
<li>Pipe number and flags don&apos;t need to changed</li>
</ul>
<p>List of connector types:</p>
<ul>
<li><code>00 04 00 00</code> - DisplayPort</li>
<li><code>00 08 00 00</code> - HDMI</li>
<li><code>04 00 00 00</code> - Digital DVI</li>
<li><code>02 00 00 00</code> - LVDS (for laptops)</li>
<li><code>01 00 00 00</code> - Dummy port</li>
</ul>
<h3 id="mapping-video-ports">Mapping video ports</h3>
<ol>
<li>Plug display into HDMI port</li>
<li>Set Port 1 to the HDMI connector type:</li>
<li>01xx0900 <strong>00080000</strong> C7030000</li>
<li><p>Disable ports 2 and 3 with busid=00:</p>
</li>
<li><p>02<strong>00</strong>0A00 00040000 C7030000</p>
</li>
<li><p>03<strong>00</strong>0800 00040000 C7030000</p>
</li>
<li><p>Walk through busids for Port 1 if the previous didn&apos;t work(yup you gotta do a shit ton of reboots). The maximum busid on most platforms is 0x06</p>
</li>
<li>01<strong>01</strong>0900 00080000 C7030000</li>
<li>01<strong>02</strong>0900 00080000 C7030000</li>
<li>01<strong>03</strong>0900 00080000 C7030000</li>
<li>etc</li>
</ol>
<p>If you still get no output, set port 1&apos;s busid to 00 and start going through busids for port 2 and so on</p>
<ul>
<li>01000900 00040000 C7030000</li>
<li>02xx0A00 00080000 C7030000</li>
<li>03000800 00040000 C7030000</li>
</ul>
<h3 id="adding-to-your-configplist">Adding to your config.plist</h3>
<p>So adding these patches are simple though a bunch of entires are required:</p>
<ul>
<li>framebuffer-con0-enable = <code>01000000</code></li>
<li>framebuffer-con1-enable = <code>01000000</code></li>
<li>framebuffer-con2-enable = <code>01000000</code></li>
<li>framebuffer-con0-alldata = port 1</li>
<li>framebuffer-con1-alldata = port 2</li>
<li>framebuffer-con2-alldata = port 3</li>
</ul>
<p>So when adding the patches, port 1 will actually become con0 as the ports start at 0. These are also all data types when entering your values.</p>
<p>A finished config should look something like this:</p>
<p><img src="https://i.imgur.com/69DyuEM.png" alt=""></p>
<p>Source for iGPU BusID patching: <a href="https://github.com/corpnewt" target="_blank">CorpNewt&apos;s Brain</a></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="legacy.html" class="navigation navigation-prev " aria-label="Previous page: Legacy Install">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="acpi.html" class="navigation navigation-next " aria-label="Next page: Getting started with ACPI">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"GPU Patching","level":"5.2","depth":1,"next":{"title":"Getting started with ACPI","level":"5.3","depth":1,"path":"extras/acpi.md","ref":"extras/acpi.md","articles":[]},"previous":{"title":"Legacy Install","level":"5.1","depth":1,"path":"extras/legacy.md","ref":"extras/legacy.md","articles":[]},"dir":"ltr"},"config":{"plugins":["theme-default","-lunr","-search","search-plus","addcssjs","favicon-plus"],"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"},"pluginsConfig":{"output":"_book","addcssjs":{"css":[],"js":[]},"fontsettings":{"theme":"night","family":"sans","size":2},"favicon-plus":{"appleTouchIconPrecomposed152":"","favicon":"","output":"_book"},"highlight":{},"favicon":"/icons/favicon.ico","appleTouchIconPrecomposed152":"/icons/appleTouchIconPrecomposed152.png","sharing":{"facebook":false,"twitter":false,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":[]},"theme-default":{"showLevel":false,"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"}},"search-plus":{}},"theme":"default","pdf":{"pageBreaksBefore":"/","headerTemplate":null,"paperSize":"a4","margin":{"right":62,"left":62,"top":36,"bottom":36},"fontSize":12,"fontFamily":"Arial","footerTemplate":null,"chapterMark":"pagebreak","pageNumbers":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"links":{"sharing":{"google":false,"facebook":false,"twitter":false,"weibo":false,"all":false}},"gitbook":"*"},"file":{"path":"extras/gpu-patches.md","mtime":"2020-02-02T04:52:58.520Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-02-02T04:53:45.235Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    

    </body>
</html>

